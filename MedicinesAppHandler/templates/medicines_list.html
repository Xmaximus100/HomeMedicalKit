{% extends "base.html" %}

{% block title %}
Leki
{% endblock %}

{% block header %}
Witaj, {{ user.username }}!
{% endblock %}

{% block content %}
    <h2 class="table-heading">Twoje Leki</h2>

    <form method="get" class="form-style">
        {{ search_form.as_p }}
        <button type="submit" class="submit-button">Filtruj</button>
    </form>

    <br>

    <form method="get" class="form-style">
        {{ records_form.as_p }}
        <button type="submit" class="submit-button">Ustaw liczbę rekordów na stronie</button>
    </form>

    <a href="{% url 'medicine_add' %}" class="link-button">Dodaj Nowy Lek</a>
    <a href="{% url 'export_medicines_csv' %}" class="link-button">Eksportuj do CSV</a>
    <a href="{% url 'side_effects_chart' %}" class="link-button">Wykres liczba działań niepożądanych dla leków</a>

    <div class="table-container">
        <div class="table-style">
            <table>
                <thead>
                    <tr>
                        <th>User_ID</th>
                        <th>Nazwa</th>
                        <th>Przeznaczenie</th>
                        <th>Ilość</th>
                        <th>Data ważności</th>
                        <th>Działania niepożądane</th>
                        <th>Substancje</th>
                        <th>Opis szczegółowy</th>
                        <th>Akcje</th>
                    </tr>
                </thead>
                <tbody>
                    {% for medicine in medicines %}
                        <tr>
                            <td>{{ medicine.user_id }}</td>
                            <td>{{ medicine.name }}</td>
                            <td>{{ medicine.purpose }}</td>
                            <td>{{ medicine.quantity }}</td>
                            <td>{{ medicine.expiration_date }}</td>
                            <td>
                                {% for side_effect in medicine.sideeffect_set.all %}
                                    <li>{{ side_effect.description }}</li>
                                {% endfor %}
                            </td>
                            <td>
                                {% for substance in medicine.substance_set.all %}
                                    <li>{{ substance.name }}</li>
                                {% endfor %}
                            </td>
                            <td>
                                <a href="{% url 'medicine_detail' medicine.id %}">Detale</a><br>
                            </td>
                            <td>
                                <a href="{% url 'medicine_edit' medicine.pk %}">Edytuj</a>
                                <a href="{% url 'medicine_delete' medicine.pk %}">Usuń</a>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
{% endblock %}
